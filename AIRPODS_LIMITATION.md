# ⚠️ 重要: AirPodsの制限について

## 問題の診断結果

診断ツール (`check_audio_devices.py`) の実行結果から、以下のことが判明しました:

```
【デバイス 4】
  名前: た　のAirPods Pro
  入力チャンネル数: 1  ← モノラル（1チャンネル）のみ
  出力チャンネル数: 0
  → モノラル入力のみです（ステレオ録音不可）
```

## AirPodsの仕様上の制限

**AirPods（Pro含む）は、macOSでは1チャンネル（モノラル）入力のみをサポートしています。**

### なぜ2チャンネルが必要か

このビームフォーミングシステムは、**左右2つの独立したマイク**からの音声を使用して話者を分離します:
- 左AirPodsのマイク → 左チャンネル
- 右AirPodsのマイク → 右チャンネル

しかし、macOSでは:
- AirPodsの左右のマイクは**内部でミックスされて1チャンネル**として出力される
- 左右を個別に取得することは**できません**

## 解決策

### 方法1: 外部ステレオマイクを使用（推奨）

ステレオ録音可能なデバイスを使用してください:

**利用可能なデバイス（診断結果より）:**
```
[0] BlackHole 2ch - ステレオ入力可能
[6] Microsoft Teams Audio - ステレオ入力可能
```

**推奨ハードウェア:**
- **Zoom H1n / H2n**: ポータブルステレオレコーダー
- **Blue Yeti**: USBステレオマイク
- **Rode NT-USB**: USBステレオマイク
- **2つの独立したUSBマイク**: 別々のデバイスとして認識

### 方法2: 2つの独立したマイクを使用

**セットアップ例:**
1. 2つのUSBマイクを用意
2. macOSの「Audio MIDI設定」で「集約デバイス」を作成
3. 2つのマイクを1つのステレオデバイスとして認識させる

**手順:**
```
1. アプリケーション > ユーティリティ > Audio MIDI設定 を開く
2. 左下の「+」ボタン > 「集約デバイスを作成」
3. 2つのマイクデバイスにチェック
4. 「ドリフト補正」を有効化
5. 作成したデバイスをプログラムで選択
```

### 方法3: BlackHoleを使用（テスト用）

BlackHole 2chが検出されています。これは仮想オーディオデバイスです。

**使用方法:**
```bash
# BlackHoleを使用してテスト
python beam_forming.py
# デバイス番号: 0 を入力
```

**注意:** BlackHoleは他のアプリケーションからの音声をルーティングするため、実際のマイク入力ではありません。

### 方法4: iPhoneやiPadを使用

iOSデバイスでは、一部のアプリが左右のマイクを個別に録音できます:
- **Ferrite Recording Studio**
- **AudioShare**

録音後、macOSに転送して処理することも可能です。

## 現在のシステムで使用可能なデバイス

診断結果から、以下のデバイスがステレオ入力可能です:

### デバイス 0: BlackHole 2ch
```bash
python beam_forming.py
# デバイス番号: 0
```
- ステレオ入力: ✓
- サンプリングレート: 48000 Hz
- 用途: 仮想オーディオルーティング

### デバイス 6: Microsoft Teams Audio
```bash
python beam_forming.py
# デバイス番号: 6
```
- ステレオ入力: ✓
- サンプリングレート: 48000 Hz
- 用途: Microsoft Teamsの仮想デバイス

## テスト実行方法

BlackHoleまたはMicrosoft Teams Audioを使用してシステムをテストできます:

```bash
# 仮想環境をアクティベート
source venv/bin/activate

# プログラムを実行
python beam_forming.py

# プロンプトで以下を入力:
# 録音時間: 10
# ビームフォーミング手法: 1
# デバイス番号: 0 (BlackHole) または 6 (Microsoft Teams Audio)
```

## 推奨: 外部ハードウェアの購入

本格的にビームフォーミングを使用する場合、以下のハードウェアを推奨します:

### 予算別推奨デバイス

**〜1万円:**
- **Zoom H1n** (約8,000円): ポータブルステレオレコーダー
- **Behringer UMC202HD** (約7,000円): 2入力オーディオインターフェース + 2本のマイク

**1万円〜3万円:**
- **Blue Yeti** (約15,000円): USBステレオマイク
- **Zoom H2n** (約18,000円): 4チャンネル録音可能
- **Focusrite Scarlett 2i2** (約20,000円): 高品質オーディオインターフェース

**3万円〜:**
- **Zoom H4n Pro** (約30,000円): プロ仕様
- **Universal Audio Volt 2** (約35,000円): スタジオ品質

## まとめ

### ❌ 使用できないもの
- AirPods（Pro含む）単体
- モノラルマイク単体

### ✓ 使用できるもの
- ステレオマイク（Blue Yetiなど）
- 2つの独立したマイク + 集約デバイス
- ステレオ録音可能なオーディオインターフェース
- BlackHole（テスト用）
- Microsoft Teams Audio（テスト用）

### 次のステップ

1. **テスト目的**: BlackHole (デバイス0) または Microsoft Teams Audio (デバイス6) を使用
2. **実用目的**: 外部ステレオマイクまたはオーディオインターフェースを購入

---

**申し訳ございません。** AirPodsの仕様上、このビームフォーミングシステムを直接使用することはできません。外部デバイスが必要です。
